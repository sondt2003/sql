----TẠO CSDL BẰNG CODE
CREATE DATABASE QLBH1

----TẠO BẢNG
-----BẢNG KHACHHANG
IF OBJECT_ID('HACHHANG') IS NOT NULL
	DROP TABLE KHACHHANG
GO
CREATE TABLE KHACHHANG
(
	MAKH	NVARCHAR(10) NOT NULL, 
	HODEM	NVARCHAR(30) NULL,
	TEN		NVARCHAR(20) NULL,
	DIACHHI	NVARCHAR(50) NULL,
	EMAIL	NVARCHAR(50) NULL,
	SDT		NVARCHAR(15) NULL,
	CONSTRAINT PK_KHACHHANG PRIMARY KEY(MAKH)
)
-----BẲNG SANPHAM
IF OBJECT_ID('SANPHAM') IS NOT NULL
	DROP TABLE SANPHAM
GO
CREATE TABLE SANPHAM
(
	MASP	NVARCHAR(10) NOT NULL,
TENSP	NVARCHAR(50) NULL,
	SLTON	INT NULL,
	DONGIA	MONEY NULL,
	NOTA	NVARCHAR(50) NULL,
	CONSTRAINT PK_SANPHAM PRIMARY KEY(MASP)
)
-----BẢNG HOADON
IF OBJECT_ID('HOADON') IS NOT NULL
	DROP TABLE HOADON
GO
CREATE TABLE HOADON
(
	MAHD	NVARCHAR(10) NOT NULL,
	NGAYMUA DATETIME,
	MAKH	NVARCHAR(10) NULL,
	TRANGTHAI	NVARCHAR(50) NULL,
	CONSTRAINT PK_HOADON PRIMARY KEY(MAHD),
	CONSTRAINT FK_HOADON_KHACHHANG	FOREIGN KEY	(MAKH)	REFERENCES KHACHHANG
)
-----BẢNG HOADONCT
IF OBJECT_ID('HOADONCT') IS NOT NULL
	DROP TABLE HOADONCT
GO
CREATE TABLE HOADONCT
(
	MAHD NVARCHAR(10) NOT NULL,
	MASP NVARCHAR(10) NOT NULL,
	SLBAN INT	NULL,
	CONSTRAINT FK_HOADONCT_HOADON FOREIGN KEY (MAHD) REFERENCES HOADON,
	CONSTRAINT FK_HOADONCT_SANPHAM FOREIGN KEY (MASP) REFERENCES SANPHAM,
	CONSTRAINT PK_HOADONCT PRIMARY KEY (MAHD, MASP)
)
----CHÈN DỮ LIỆU
-----BẢNG KHÁCH HÀNG
DELETE FROM KHACHHANG
INSERT INTO KHACHHANG VALUES
	('KH01', N'NGUYỄN CHÍ', N'CAO', N'HÀ NỘI', 'CAONCPH21458@FPT.EDU.VN', '0787304217'),
	('KH02', N'LÊ', N'THỎ', N'HÀ NỘI', 'THOLPH21458@FPT.EDU.VN', '0787304317'),
	('KH03', N'NGUYỄN VĂN', N'A', N'ĐÀ NẴNG', 'ANCPH21458@FPT.EDU.VN', '0787314217'),
	('KH04', N'NGUYỄN CHÍ', N'B', N'ĐÀ NẴNG', 'BNCPH21458@FPT.EDU.VN', '0788304217'),
	('KH05', N'NGUYỄN CHÍ', N'C', N'HÀ NỘI', 'CNCPH21458@FPT.EDU.VN', '0787204217')
-----BẢNG SẢN PHẨM
DELETE FROM SANPHAM
INSERT INTO SANPHAM VALUES
	('SP01', N'GÀ', 30, 96.000, N'OLD'),
	('SP02', N'VIT', 35, 123.000, N'NEW'),
	('SP03', N'NGAN', 31, 98.000, N'NEW'),
	('SP04', N'KEM', 126, 28.000, N'NEW'),
	('SP05', N'xu', 216, 28.000, N'NEW')
-----BẢNG HÓA ĐƠN
DELETE FROM HOADON
INSERT INTO HOADON VALUES
	('HD01','3/30/2022','KH01',N'ĐÃ THANH TOÁN'),
	('HD02','3/15/2022','KH01',N'ĐÃ THANH TOÁN'),
	('HD03','3/4/2022','KH02',N'CHƯA THANH TOÁN'),
	('HD04','3/19/2022','KH05',N'ĐÃ THANH TOÁN'),
	('HD05','3/01/2022','KH04',N'CHƯA THANH TOÁN')
----HÓA ĐƠN CHI TIÉT
DELETE FROM HOADONCT
INSERT INTO HOADONCT VALUES
	('HD05','SP01',10),
	('HD05','SP02',8),
	('HD02','SP01',2),
	('HD04','SP03',12),
	('HD04','SP02',24)


----TRUY VẤN
SELECT * FROM KHACHHANG
SELECT * FROM SANPHAM
SELECT * FROM HOADON
SELECT * FROM HOADONCT
SELECT MAKH,HODEM +''+TEN AS HOTEN,DIACHHI FROM KHACHHANG WHERE DIACHHI = N'HÀ NỘI';
SELECT * FROM SANPHAM  WHERE SLTON BETWEEN 10 AND 200;
SELECT * FROM SANPHAM WHERE SLTON IN (30,31)
SELECT * FROM HOADON WHERE TRANGTHAI  LIKE N'CHƯA%'
SELECT COUNT(*)FROM KHACHHANG;
select MAX(DONGIA) FROM SANPHAM
SELECT * FROM HOADON WHERE MONTH(NGAYMUA) = 3 AND YEAR(NGAYMUA) =2022 AND TRANGTHAI LIKE N'CHƯA%'
SELECT MAHD,COUNT(MASP) AS SOLUONG     FROM HOADONCT GROUP BY MAHD HAVING COUNT(MASP) >=3
SELECT MAHD,NGAYMUA,MAKH FROM HOADON ORDER BY DAY(NGAYMUA) DESC
SELECT KHACHHANG.* FROM KHACHHANG JOIN HOADON ON KHACHHANG.MAKH = HOADON.MAKH
JOIN HOADONCT ON HOADON.MAHD = HOADONCT.MAHD 
JOIN SANPHAM ON SANPHAM.MASP = HOADONCT.MASP

SELECT TENSP, SLBAN FROM SANPHAM JOIN HOADONCT ON SANPHAM.MASP = HOADONCT.MASP WHERE SLBAN < (SELECT AVG(SLBAN) FROM HOADONCT);


--BAI 1
SELECT HOADON.MAHD,MAKH,MASP,SLBAN FROM HOADON JOIN HOADONCT ON HOADON.MAHD = HOADONCT.MAHD;
SELECT HOADON.MAHD,KHACHHANG.MAKH,TRANGTHAI,HOADONCT.MASP,SLTON,NGAYMUA FROM KHACHHANG JOIN HOADON ON KHACHHANG.MAKH =HOADON.MAKH JOIN HOADONCT ON HOADON.MAHD = HOADONCT.MAHD JOIN SANPHAM ON HOADONCT.MASP = SANPHAM.MASP WHERE KHACHHANG.MAKH ='KH01'
SELECT HOADON.MAHD,NGAYMUA,TENSP,DONGIA,SLBAN,DONGIA*SLBAN AS THANHTIEN  FROM HOADON JOIN HOADONCT ON HOADON.MAHD = HOADONCT.MAHD JOIN SANPHAM ON HOADONCT.MASP = SANPHAM.MASP
SELECT TEN,EMAIL,SDT,HOADON.MAHD,TRANGTHAI FROM KHACHHANG JOIN HOADON ON KHACHHANG.MAKH = HOADON.MAKH JOIN HOADONCT ON HOADON.MAHD = HOADONCT.MAHD WHERE TRANGTHAI LIKE N'CHƯA%';
SELECT FROM  KHACHHANG JOIN HOADON ON KHACHHANG.MAKH = HOADON.MAKH








